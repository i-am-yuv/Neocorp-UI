<p-toast></p-toast>

<div class="">
    <div class="bg-white">
        <!-- <div class="flex bg-gray-300 button-container">
                    <button type="button" pButton label="+ Create SI" (click)="CreateNewSI()"
                        class="mt-3  text-lg mr-3 mb-3 p-button-raised bg-blue-500 text-white px-4 py-2.5 rounded-md hover:bg-blue-600 "></button>
                </div> -->
        <div class="border-bottom-1 border-200 text-right p-3">
            <button type="button" pButton label="+ Create SI" (click)="CreateNewSI()"
                class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800  "></button>
        </div>
    </div>

    <div class="m-6 bg-white border-round-3xl">
        <div class="p-5">
            <div class="flex gap-4" style=" justify-content: center;">
                <div class="col-5 ">
                    <p-panel class="left-panel ">
                        <ng-template pTemplate="header">
                            <span class="p-panel-title" style="padding: 1px">All Sales Invoices</span>
                        </ng-template>
                        <ng-template pTemplate="content">
                            <div class="left-panel-content">
                                <br />
                                <!-- <div class="left-panel-content"> -->
                                <div *ngFor="let item of allSIs" class="order-list"
                                    [ngClass]="{ 'bg-gray-100': activeInvoice.id === item.id }">
                                    <div class="list-item" (click)="changeOrder(item)">
                                        <div class="iconSCSS w-full gap-2 p-3">
                                            <div class=" col-2 justify-center align-center">
                                                <div class=" person-icon">{{
                                                    item.vendor?.firstName.charAt(0) +
                                                    item.vendor?.lastName.charAt(0) }}</div>
                                            </div>
                                            <div class=" col-10">
                                                <div class="text-base "><b>{{ item.invoiceNo }}</b></div>
                                                <div class="flex gap-2 " *ngIf="item.vendor">
                                                    <div class="col-8 font-italic text-base">
                                                        {{ item.vendor?.firstName }} {{ item.vendor?.lastName }}<br>
                                                        <p class="font-light text-sm">Date: {{item.invoiceDate| date
                                                            :'yyyy-MM-dd'}}</p>
                                                    </div>
                                                    <div class="col-4 text-base text-right">
                                                        <b>₹: </b>{{item.grossTotal?item.grossTotal : '0.00'}}<br>
                                                        <p class="leftStatus">{{item.status}}</p>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2" *ngIf="item.customer">
                                                    <div class="col-8 font-italic text-base" *ngIf="item.customer">
                                                        {{ item.customer?.displayName }}
                                                    </div>
                                                    <div class="col-4 text-base text-right">
                                                        <b>₹: </b>{{item.grossTotal?item.grossTotal : '0.00'}}<br>
                                                        <p class="leftStatus">{{item.status}}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center m-5" *ngIf="allSIs.length === 0">
                                    No Sales Invoice Available
                                </div>
                            </div>
                        </ng-template>
                        <p-footer> Total: {{ this.totalRecords}} </p-footer>
                    </p-panel>
                </div>

                <div class="col-7">
                    <p-panel>
                        <ng-template pTemplate="header">
                            <div class="w-full">
                                <div class="grid m-0">
                                    <div class="col-6 p-0">
                                        <span class="p-panel-title">Sales Invoice</span>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <div class="right-panel-content">
                            <div class="text-center m-5" *ngIf="!activeInvoice.id">
                                <img src="assets/empty.svg" width="250" /><br />
                                Select Sales Invoice
                            </div>
                            <div *ngIf="activeInvoice.id">

                                <!-- <div class="flex bg-gray-700 gap-3 rounded-div1 mr-3 p-3 ">
                                    <div class="field col-7  ml-3 ">
                                        <h4 class="text-gray-200">Payment Activity</h4>
                                        <h4 class="text-white">#{{this.activeInvoice.salesOrder?.documentno}}
                                        </h4>

                                        <div class="flex gap-5 bg-white rounded-div mt-3 justify-center">
                                            <div class="field col-6 ml-3">
                                                <h5>Current Due</h5>
                                                <h4 class="text-red-700 text-lg"><b>₹ {{this.currentDue}}</b></h4>
                                            </div>
                                            <div class="field col-6">
                                                <h5>Total Amount</h5>
                                                <h4 class="text-lg"><b>₹ {{this.activeInvoice.grossTotal}}</b></h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field col-4 bg-gray-700">
                                        <div class=" bg-red-400 rounded-div mt-2">
                                            <h4 class="text-white text-center">Status: {{this.activeInvoice.status}}
                                            </h4>
                                        </div>
                                        <div>
                                            <div class="mt-4">
                                                <h5 class="text-white">Invoice Date: {{ this.activeInvoice.invoiceDate |
                                                    date : "short"}}</h5>
                                                <hr class="border-gray-200">
                                                <h5 class="text-white">Due Date: Nil</h5>
                                            </div>
                                        </div>
                                    </div>

                                </div> -->

                                <div class="flex bg-gray-700 gap-3 rounded-div1 mr-3 p-2 ">
                                    <div class="field col-7  ml-3 ">
                                        <h4 class="rightMain">Payment Activity</h4>
                                        <h4 class="text-white">#{{this.activeInvoice.salesOrder?.documentno}}
                                        </h4>

                                        <div class="flex gap-5 bg-white rounded-div1 mt-3 ">
                                            <div class="field col-6">
                                                <h5>Current Due</h5>
                                                <h4 class="remainAmount text-xl">₹ {{this.currentDue}}</h4>
                                            </div>
                                            <div class="field col-6">
                                                <h5>Total Amount</h5>
                                                <h4 class="text-xl">₹ {{this.activeInvoice.grossTotal}}</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field col-4 bg-gray-700">
                                        <div class=" bg-red-100 mt-2 ml-2 mr-2 rounded-div1">
                                            <!-- <h4 class="text-center text-red-400 text-base">Status: {{this.activeInvoice.status}}
                                            </h4> -->
                                            <h4 *ngIf="this.activeInvoice.status!='COMPLETED'"
                                                class="text-center text-red-400 text-base cursor-pointer"
                                                [routerLink]="['/payment/makePayment/si/'+this.activeInvoice.id  ]">
                                                <div class="flex gap-1  w-full">
                                                    <div class="col-3 leftP text-right">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                            viewBox="0 0 18 18" fill="none">
                                                            <path
                                                                d="M9 15.75C7.66498 15.75 6.35993 15.3541 5.2499 14.6124C4.13987 13.8707 3.27471 12.8165 2.76382 11.5831C2.25292 10.3497 2.11925 8.99252 2.3797 7.68314C2.64015 6.37377 3.28303 5.17104 4.22703 4.22703C5.17104 3.28303 6.37377 2.64015 7.68314 2.3797C8.99251 2.11925 10.3497 2.25292 11.5831 2.76382C12.8165 3.27471 13.8707 4.13987 14.6124 5.2499C15.3541 6.35994 15.75 7.66498 15.75 9C15.75 10.7902 15.0388 12.5071 13.773 13.773C12.5071 15.0388 10.7902 15.75 9 15.75ZM9 3.21429C7.8557 3.21429 6.73709 3.55361 5.78563 4.18936C4.83418 4.8251 4.09261 5.72871 3.6547 6.78591C3.21679 7.84311 3.10222 9.00642 3.32546 10.1287C3.5487 11.2511 4.09974 12.282 4.90888 13.0911C5.71803 13.9003 6.74895 14.4513 7.87127 14.6745C8.99358 14.8978 10.1569 14.7832 11.2141 14.3453C12.2713 13.9074 13.1749 13.1658 13.8106 12.2144C14.4464 11.2629 14.7857 10.1443 14.7857 9C14.7857 7.46554 14.1761 5.99392 13.0911 4.90889C12.0061 3.82385 10.5345 3.21429 9 3.21429Z"
                                                                fill="#C22B39" />
                                                            <path
                                                                d="M10.6457 12.75L8.25 9.95501V5.25H9.10714V9.54001L11.25 12.045L10.6457 12.75Z"
                                                                fill="#C22B39" />
                                                        </svg>
                                                    </div>
                                                    <div class="col-9 rightP text-left">
                                                        {{this.activeInvoice.status}}
                                                    </div>
                                                </div>
                                            </h4>
                                            <h4 *ngIf="this.activeInvoice.status=='COMPLETED'"
                                                class="text-center text-green-400 text-base">Status:
                                                {{this.activeInvoice.status}}
                                            </h4>
                                        </div>
                                        <div>
                                            <div class="mt-5">
                                                <h5 class="text-white">Invoice Date: {{ this.activeInvoice.invoiceDate |
                                                    date:'yyyy-MM-dd' }}</h5>
                                                <hr class="custom-hr ">
                                                <h5 class="text-white">Due Date: Nil</h5>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="flex mt-3">
                                    <div class="field col-8">
                                        <h4 class="text-blue-700">Sales Invoice Details:</h4>
                                    </div>
                                    <!-- <div class="field col-1">
                                        <button pButton type="button" icon="pi pi-pencil"
                                            (click)="onEditSI(activeInvoice.id)"></button>
                                    </div> -->
                                </div>
                                <div class="flex gap-1">
                                    <div class="field col-6">
                                        <label class="mr-3 blueText">Sales Invoice Number:</label>
                                        <p><b>#{{ this.activeInvoice.invoiceNo}}</b></p>
                                    </div>

                                    <div class="field col-6">
                                        <label class="mr-3">Invoice Date:</label>
                                        <p>{{ this.activeInvoice.invoiceDate | date : 'yyyy-MM-dd'}}</p>
                                    </div>
                                </div>

                                <div class="flex gap-1">
                                    <div class="field col-6">
                                        <label class="mr-3 blueText">Sales Order Details</label>
                                        <p>Order Number: #{{this.activeInvoice.salesOrder?.documentno}}
                                        </p>
                                    </div>
                                    <div class="field col-6">
                                        <label class="mr-3 blueText">Vendor Invoice Details:</label>
                                        <p>Invoice Number: #{{this.activeInvoice.vendorInvoice?.documentnumber}}</p>
                                    </div>
                                    <br>
                                </div>

                                <hr class="custom-hr ">
                                <div class="flex gap-2">
                                    <div class="field col-7">
                                        <!-- <h4 class="text-blue-500">Bill From</h4> <br>  -->
                                        <label class="mr-3 blueText">Bill From:</label>
                                        <p>{{this.activeInvoice.vendor?.address?.billingName}}</p>
                                        <p>{{this.activeInvoice.vendor?.address?.billingAddress}}</p>
                                        <p>{{this.activeInvoice.vendor?.address?.city}}
                                            ,{{this.activeInvoice.vendor?.address?.pincode}}</p>
                                    </div>
                                    <div class="field col-4">
                                        <!-- <h4 class="text-blue-500">Place Of Supply</h4>  -->
                                        <label class="mr-3 blueText">Place Of Supply</label>
                                        <p>{{this.activeInvoice.salesOrder?.placeOfSupply?.stateName}}</p><br>
                                    </div>
                                </div>

                                <div>
                                    <p-table [value]="lineitems">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th class="text-blue-600">Item Detils</th>
                                                <th class="text-blue-600">Price</th>
                                                <th class="text-blue-600">Quantity</th>
                                                <th class="text-blue-600">Discount</th>
                                                <th class="text-blue-600">Total</th>
                                            </tr>
                                        </ng-template>
                                        <ng-template let-lineItem pTemplate="body">
                                            <tr>
                                                <td>{{ lineItem.expenseName?.name }}</td>
                                                <td>{{ lineItem.unitPrice }}</td>
                                                <td>{{ lineItem.quantity }}</td>
                                                <td>{{ lineItem.discount }}</td>
                                                <td>{{ lineItem.amount }}</td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <!-- <div class="flex mt-5">
                                        <div class="field col-6">

                                        </div>
                                        <div class="field col-6">
                                            <label class="mr-3">SubTotal:<b> {{this.siSubTotal}}</b> </label>

                                            <hr>
                                            <label class="mr-3">Total:<b> {{this.siSubTotal}}</b> </label>
                                        </div>
                                    </div> -->

                                    

                                    <div class=" border-200 text-right mr-6 mb-3 mt-3">
                                        <div class="text-lg blueText">
                                            SUB TOTAL: ₹ {{this.siSubTotal}}
                                        </div> <br>
                                        <div class="text-lg blueText">
                                            TOTAL: ₹ {{this.siSubTotal}}
                                        </div>
                                    </div>
                                </div>
                                <hr class="custom-hr">

                                <div class="flex">
                                    <div class="field col-10">
                                        <p class="blueText">Current Status:</p>
                                        <p>{{this.activeInvoice.status}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <p-footer>
                                </p-footer> -->
                    </p-panel>
                </div>
            </div>


        </div>
    </div>
</div>
<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>