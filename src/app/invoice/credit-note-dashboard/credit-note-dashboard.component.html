<p-toast></p-toast>


<div class="">
    <!-- <div class="bg-white">
        <div class="border-bottom-1 border-200 text-right p-3">
            <button type="button" pButton label="+ Create Credit Note" (click)="CreateNewCreditNote()"
                class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800  "></button>
        </div>
    </div> -->

    <div class="bg-white iconSCSS1">
        <div class="col-4">
            <!-- <p-breadcrumb class="max-w-full" [model]="items"></p-breadcrumb> -->
        </div>
        <div class="col-8">
            <div class="border-200 text-right">
                <button type="button" pButton (click)="CreateNewCreditNote()" class=" mr-3 custom-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="mr-2" viewBox="0 0 20 20"
                        fill="none">
                        <path
                            d="M17.5 10C17.5 10.1658 17.4342 10.3247 17.3169 10.4419C17.1997 10.5592 17.0408 10.625 16.875 10.625H10.625V16.875C10.625 17.0408 10.5592 17.1997 10.4419 17.3169C10.3247 17.4342 10.1658 17.5 10 17.5C9.83424 17.5 9.67527 17.4342 9.55806 17.3169C9.44085 17.1997 9.375 17.0408 9.375 16.875V10.625H3.125C2.95924 10.625 2.80027 10.5592 2.68306 10.4419C2.56585 10.3247 2.5 10.1658 2.5 10C2.5 9.83424 2.56585 9.67527 2.68306 9.55806C2.80027 9.44085 2.95924 9.375 3.125 9.375H9.375V3.125C9.375 2.95924 9.44085 2.80027 9.55806 2.68306C9.67527 2.56585 9.83424 2.5 10 2.5C10.1658 2.5 10.3247 2.56585 10.4419 2.68306C10.5592 2.80027 10.625 2.95924 10.625 3.125V9.375H16.875C17.0408 9.375 17.1997 9.44085 17.3169 9.55806C17.4342 9.67527 17.5 9.83424 17.5 10Z"
                            fill="white" />
                    </svg> Create Credit Note
                </button>
            </div>
        </div>
    </div>

    <div class="m-6 bg-white border-round-3xl">
        <div class="p-5">

            <div class="flex gap-4" style=" justify-content: center;">
                <div class="col-5">
                    <p-panel class="left-panel">
                        <ng-template pTemplate="header">
                            <span class="p-panel-title" style="padding: 1px">All Credit Notes</span>
                        </ng-template>
                        <div class="p-inputgroup pl-2 pr-2 pt-2">

                            <input pInputText placeholder="Search" [(ngModel)]="searchCN" class="w-full custom-input"
                                (ngModelChange)="searchCNs(searchCN)" />
                            <button type="button" pButton pRipple icon="pi pi-search" (click)="searchCNs(searchCN)"
                                styleClass="p-button-success">
                            </button>

                        </div>
                        <ng-template pTemplate="content">
                            <div class="left-panel-content">
                                <br />
                                <!-- <div class="left-panel-content"> -->
                                <!-- <div *ngFor="let item of allCreditNotes" class="order-list"
                                    [ngClass]="{ 'bg-gray-100': activeCN.id === item.id }">
                                    <div class="p-5 list-item" (click)="changeOrder(item)">
                                        <div class="text-base ml-3"><b>{{ item.creditNoteNo }}</b></div>
                                        <div class="flex text-right" *ngIf="item.creditToVendor">
                                            <div class=" font-italic text-base mt-2 mb-2 ml-3">
                                                {{ item.creditToVendor?.firstName }}
                                            </div>
                                            <div class="col-6 text-base mt-2 mb-2">
                                                <b>₹: </b>{{item.grossTotal}}
                                            </div>
                                        </div>
                                        <div class="flex" *ngIf="item.creditToCustomer">
                                            <div class="font-italic text-base mt-2 mb-2 ml-3"
                                                *ngIf="item.creditToCustomer">
                                                {{ item.creditToCustomer?.displayName }}
                                            </div>
                                            <div class="col-6 text-base mt-2 mb-2 ">
                                                <b>₹: </b>{{item.grossTotal}}
                                            </div>
                                        </div>
                                    </div>
                                </div> -->

                                <div *ngFor="let item of allCreditNotes" class="order-list"
                                    [ngClass]="{ 'bg-gray-100': activeCN.id === item.id }">
                                    <div class=" list-item" (click)="changeOrder(item)">
                                        <div class="iconSCSS w-full gap-2 p-3">
                                            <div class="col-2  justify-center align-center">
                                                <!-- <div class="person-icon">{{
                                                    item.vendor?.firstName.charAt(0) +
                                                    item.vendor?.lastName.charAt(0) }}</div> -->
                                                <div class="person-icon">
                                                    {{item.customer.displayName.charAt(0)}}{{item.customer.displayName.split('
                                                    ')[1] ? item.customer.displayName.split(' ')[1].charAt(0) : '' }}
                                                </div>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-base"><b>{{ item.creditNoteNo }}</b></div>
                                                <div class="flex gap-2">
                                                    <div class="col-8 font-italic text-base ">
                                                        {{ item.customer?.displayName ? item.customer?.displayName :
                                                        'NA' }}
                                                    </div>
                                                    <div class="col-4 text-base text-right ">
                                                        <b>₹: </b>{{item.grossTotal ? item.grossTotal : '0.00'}}<br>
                                                        <p class="text-black">{{item.requestStatus}}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center m-5" *ngIf="allCreditNotes.length === 0">
                                    No Credit Notes Available, Please Create One
                                </div>
                            </div>
                        </ng-template>
                        <p-footer> Total: {{ this.totalRecords}} </p-footer>
                    </p-panel>
                </div>

                <div class="col-7">
                    <p-panel>
                        <ng-template pTemplate="header">
                            <div class="w-full">
                                <div class="grid m-0">
                                    <div class="col-6 p-0">
                                        <span class="p-panel-title">Credit Note Details</span>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <div class="right-panel-content">
                            <div class="text-center m-5" *ngIf="!activeCN.id">
                                <img src="/assets/CM.png" width="200" height="auto">
                                <br>
                                <p class="mt-4 text-xl">Please, Select Credit Note</p>
                            </div>
                            <div *ngIf="activeCN.id">
                                <!-- <h3 class="text-lg ">Purchase Order Details</h3>
                                        <br> -->

                                <!-- <div class="flex bg-gray-700 gap-3 rounded-div1 mr-3 p-2 ">
                                    <div class="field col-7  ml-3 ">
                                        <h4 class="text-gray-200">Payment Activity</h4>
                                        <h4 class="text-white">#{{this.activeCN.creditNoteNo}}
                                        </h4>

                                        <div class="flex gap-5 bg-white rounded-div1 mt-3 ">
                                            <div class="field col-6">
                                                <h5>Current Due</h5>
                                                <h4 class="remainAmount text-lg">₹ {{this.currentDue}}</h4>
                                            </div>
                                            <div class="field col-6">
                                                <h5>Total Amount</h5>
                                                <h4 class="text-lg">₹ {{this.activeCN.grossTotal}}</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field col-4 bg-gray-700">
                                        <div class=" bg-red-100 mt-2 ml-2 mr-2 rounded-div1">
                                            <h4 class="text-center text-red-400 text-base">Status:
                                                {{this.activeCN.requestStatus}}
                                            </h4>
                                        </div>
                                        <div>
                                            <div class="mt-5">
                                                <h5 class="text-white">Start Date: {{ this.activeCN.startdate |
                                                    date:'yyyy-MM-dd' }}</h5>
                                                <hr class="border-gray-200">
                                                <h5 class="text-white">Due Date: {{ this.activeCN.duedate |
                                                    date:'yyyy-MM-dd' }}</h5>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->

                                <div class="flex mt-3">
                                    <div class="field col-8">
                                        <h4 class="blueText">Credit Note Details:</h4>
                                    </div>
                                    <!-- <div class="field col-1">
                                        <button pButton type="button" icon="pi pi-pencil"
                                            (click)="onEditCN(activeCN.id)"></button>
                                    </div> -->

                                    <div class="iconSCSS w-full gap-1 mr-3 cursor-pointer"
                                        (click)="onEditCN(activeCN.id)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22"
                                            viewBox="0 0 10 11" fill="none">
                                            <g clip-path="url(#clip0_862_17281)">
                                                <path
                                                    d="M7.0257 2.11389L7.72882 1.37075C8.03392 1.04829 8.52858 1.04829 8.83368 1.37075C9.13877 1.69321 9.13877 2.21602 8.83368 2.53848L4.40924 7.21469C4.18896 7.44751 3.91726 7.61864 3.6187 7.71264L2.5 8.06485L2.83324 6.88249C2.92218 6.56694 3.0841 6.27978 3.30438 6.04697L7.0257 2.11389ZM7.0257 2.11389L8.125 3.27574M7.5 6.30334V8.39513C7.5 8.94236 7.08027 9.38598 6.5625 9.38598H2.1875C1.66973 9.38598 1.25 8.94236 1.25 8.39513V3.77117C1.25 3.22394 1.66973 2.78032 2.1875 2.78032H4.16667"
                                                    stroke="#6F7174" stroke-width="0.625" stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_862_17281">
                                                    <rect width="10" height="10.5691" fill="white"
                                                        transform="translate(0 0.138184)" />
                                                </clipPath>
                                            </defs>
                                        </svg>
                                        <div class="text-sm blueText">Edit Crdit Note</div>
                                    </div>

                                </div>
                                <div class="flex ">
                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Credit Note Number:</label>
                                        <p>#{{ this.activeCN.creditNoteNo}}</p>
                                    </div>

                                    <div class="field col-4">
                                        <label class="mr-3 ">Start on:</label>
                                        <p>{{ this.activeCN.startdate | date:'yyyy-MM-dd'}}</p>
                                    </div>

                                    <div class="field col-4">
                                        <label class="mr-3 ">Due Date:</label>
                                        <p>{{ this.activeCN.duedate | date:'yyyy-MM-dd'}}</p>
                                    </div>
                                </div>

                                <hr class="border-gray-200">

                                <div class="flex">
                                    <div class="field col-7">
                                        <!-- <h4 class="text-blue-500">Bill From</h4> <br>  -->
                                        <label class="mr-3 blueText">Bill From:</label>
                                        <p>{{this.activeCN.customer?.address?.billingName}}</p>
                                        <p>{{this.activeCN.customer?.address?.billingAddress}}</p>
                                        <p>{{this.activeCN.customer?.address?.city}}
                                            ,{{this.activeCN.customer?.address?.pincode}}</p>
                                    </div>
                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Place of Supply</label>
                                        <p>{{this.activeCN.placeOfSupply?.stateName}}</p>
                                    </div>
                                    <br>
                                </div>

                                <div>
                                    <p-table [value]="lineitems">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th>Item Detils</th>
                                                <th>Price</th>
                                                <th>Quantity</th>
                                                <th>Discount</th>
                                                <th>Total</th>
                                            </tr>
                                        </ng-template>
                                        <ng-template let-lineItem pTemplate="body">
                                            <tr>
                                                <td>{{ lineItem.expenseName?.name }}</td>
                                                <td>{{ lineItem.unitPrice }}</td>
                                                <td>{{ lineItem.quantity }}</td>
                                                <td>{{ lineItem.discount }}</td>
                                                <td>{{ lineItem.amount }}</td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <div class=" border-200 text-right mr-6 mb-3 mt-3">
                                        <div class="text-lg blueText">
                                            SUB TOTAL: ₹ {{this.cnSubTotal}}
                                        </div> <br>
                                        <div class="text-lg blueText">
                                            TOTAL: ₹ {{this.cnSubTotal}}
                                        </div>
                                    </div>

                                </div>

                                <div class="flex">
                                    <div class="field col-6">
                                        <h4 class="blueText">Description:</h4>
                                        <p>{{this.activeCN.creditNoteDescription}}</p>
                                    </div>
                                    <div class="field col-6">
                                        <h4 class="blueText">Internal Notes:</h4>
                                        <p>{{this.activeCN.notes}}</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </p-panel>
                </div>

            </div>


        </div>
    </div>
</div>

<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>