<p-toast></p-toast>


<div class="">
    <div class="bg-white">
        <div class="border-bottom-1 border-200 text-right p-3">
            <button type="button" pButton label="+ Create Sales Order" (click)="CreateNewSalesOrder()"
                class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800  "></button>
        </div>
    </div>

    <div class="m-6 bg-white border-round-3xl">
        <div class="p-5">

            <div class="flex gap-4" style=" justify-content: center;">

                <div class="col-5">
                    <p-panel class="left-panel">
                        <ng-template pTemplate="header">
                            <span class="p-panel-title" style="padding: 1px">Sales Orders</span>
                        </ng-template>
                        <ng-template pTemplate="content">
                            <div class="left-panel-content">
                                <br />
                                <!-- <div class="left-panel-content"> -->
                                <!-- <div *ngFor="let item of allSalesOrder" class="order-list"
                                            [ngClass]="{ 'bg-gray-100': activeOrder.id === item.id }">
                                            <div class="p-5 list-item" (click)="changeOrder(item)">
                                                <div class="text-base ml-3"><b>{{ item.documentno }}</b></div>
                                                <div class="flex text-right">
                                                    <div class=" font-italic text-base mt-2 mb-2 ml-3">
                                                        {{ item.vendor?.firstName }} {{ item.vendor?.lastName }}
                                                    </div>
                                                    <div class="col-6 text-base mt-2 mb-2">
                                                        <b>₹: </b>{{item.grossTotal}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div> -->

                                <div *ngFor="let item of allSalesOrder" class="order-list"
                                    [ngClass]="{ 'bg-gray-100': activeOrder.id === item.id }">
                                    <div class="list-item" (click)="changeOrder(item)">
                                        <div class="iconSCSS w-full gap-2 p-3">
                                            <div class=" col-2  justify-center align-center">
                                                <div class="person-icon">{{
                                                    item.vendor?.firstName.charAt(0) +
                                                    item.vendor?.lastName.charAt(0) }}</div>
                                            </div>
                                            <div class=" col-10">
                                                <div class="text-base"><b>{{ item.documentno }}</b></div>
                                                <div class="flex gap-2 " *ngIf="item.vendor">
                                                    <div class="col-8 font-italic text-base  ">
                                                        {{ item.vendor?.firstName }} {{ item.vendor?.lastName }} <br>
                                                        <p class="font-light text-sm">Date: {{item.dueDate| date
                                                            :'yyyy-MM-dd'}}</p>
                                                    </div>
                                                    <div class="col-4 text-base text-right">
                                                        <b>₹: </b>{{item.grossTotal ?item.grossTotal : '0.00' }}
                                                    </div>
                                                </div>
                                                <div class="flex gap-2" *ngIf="item.customer">
                                                    <div class="col-6 font-italic text-base mt-2 mb-2 ml-3"
                                                        *ngIf="item.customer">
                                                        {{ item.customer?.displayName }}
                                                    </div>
                                                    <div class="col-4 text-base mt-2 mb-2 ">
                                                        <b>₹: </b>{{item.grossTotal ?item.grossTotal : '0.00' }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center m-5" *ngIf="allSalesOrder.length === 0">
                                    No Sales Order Available
                                </div>
                            </div>
                        </ng-template>
                        <p-footer> Total: {{ this.totalRecords}} </p-footer>
                    </p-panel>
                </div>

                <div class="col-7">
                    <p-panel>
                        <ng-template pTemplate="header">
                            <div class="w-full">
                                <div class="grid m-0">
                                    <div class="col-6 p-0">
                                        <span class="p-panel-title">Sales Order Details</span>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <div class="right-panel-content">
                            <div class="text-center m-5" *ngIf="!activeOrder.id">
                                <img src="assets/empty.svg" width="250" /><br />
                                Select Sales Order
                            </div>
                            <div *ngIf="activeOrder.id">
                                <!-- <h3 class="text-lg ">Purchase Order Details</h3>
                                        <br> -->
                                <div class="flex">
                                    <div class="field col-8">
                                        <h4 class="">Sales Order Details:</h4>
                                    </div>
                                    <!-- <div class="field col-4 text-right">
                                        <button pButton type="button" icon="pi pi-pencil"
                                            (click)="onEditSO(activeOrder.id)"></button>
                                    </div> -->
                                    <div class="iconSCSS w-full gap-1 mr-3 cursor-pointer" (click)="onEditSO(activeOrder.id)"  >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22" 
                                            viewBox="0 0 10 11" fill="none">
                                            <g clip-path="url(#clip0_862_17281)">
                                                <path
                                                    d="M7.0257 2.11389L7.72882 1.37075C8.03392 1.04829 8.52858 1.04829 8.83368 1.37075C9.13877 1.69321 9.13877 2.21602 8.83368 2.53848L4.40924 7.21469C4.18896 7.44751 3.91726 7.61864 3.6187 7.71264L2.5 8.06485L2.83324 6.88249C2.92218 6.56694 3.0841 6.27978 3.30438 6.04697L7.0257 2.11389ZM7.0257 2.11389L8.125 3.27574M7.5 6.30334V8.39513C7.5 8.94236 7.08027 9.38598 6.5625 9.38598H2.1875C1.66973 9.38598 1.25 8.94236 1.25 8.39513V3.77117C1.25 3.22394 1.66973 2.78032 2.1875 2.78032H4.16667"
                                                    stroke="#6F7174" stroke-width="0.625" stroke-linecap="round"
                                                    stroke-linejoin="round" />
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_862_17281">
                                                    <rect width="10" height="10.5691" fill="white"
                                                        transform="translate(0 0.138184)" />
                                                </clipPath>
                                            </defs>
                                        </svg>
                                        <div class="text-sm font-light">Edit Sales Order</div>

                                    </div>
                                </div>
                                <div class="flex">
                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Company Name: </label>
                                        <p>{{ this.activeOrder.company?.companyName}}</p>
                                    </div>
                                </div>

                                <hr class=" custom-hr">

                                <div class="flex">
                                    <div class="field col-6">
                                        <label class="mr-3 blueText">Sales Order Number:</label>
                                        <p><b>#{{ this.activeOrder.documentno}}</b></p>
                                    </div>

                                    <div class="field col-3">
                                        <label class="mr-3 ">Bill on:</label>
                                        <p>{{ this.activeOrder.billDate | date : 'yyyy-MM-dd' }}</p>
                                    </div>

                                    <div class="field col-3">
                                        <label class="mr-3 ">Due Date:</label>
                                        <p>{{ this.activeOrder.dueDate | date : 'yyyy-MM-dd'}}</p>
                                    </div>
                                </div>

                                <hr class="custom-hr">

                                <div class="flex gap-3">
                                    <div class="field col-7">
                                        <label class="mr-3 blueText">Dispatch To</label><br>
                                        <p>{{this.activeOrder.vendor?.address?.billingName}} <br>
                                            {{this.activeOrder.vendor?.address?.billingAddress}}<br>
                                            {{this.activeOrder.vendor?.address?.city}},
                                            {{this.activeOrder.vendor?.address?.pincode}}
                                        </p>
                                        <br>
                                    </div>
                                    <div class="field col-4">
                                        <label class="mr-3  blueText">Place Of Supply</label><br>
                                        <p>{{this.activeOrder.placeOfSupply?.stateName}}</p><br>
                                    </div>
                                </div>

                                <div>
                                    <p-table [value]="lineitems">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th class="text-blue-600">Item Detils</th>
                                                <th class="text-blue-600">Price</th>
                                                <th class="text-blue-600">Quantity</th>
                                                <th class="text-blue-600">Discount</th>
                                                <th class="text-blue-600">Total</th>
                                            </tr>
                                        </ng-template>
                                        <ng-template let-lineItem pTemplate="body">
                                            <tr>
                                                <td>{{ lineItem.expenseName?.name }}</td>
                                                <td>{{ lineItem.unitPrice }}</td>
                                                <td>{{ lineItem.quantity }}</td>
                                                <td>{{ lineItem.discount }}</td>
                                                <td>{{ lineItem.amount }}</td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <!-- <div class="flex mt-5">
                                        <div class="field col-6">

                                        </div>
                                        <div class="field col-6">
                                            <label class="mr-3">SubTotal:<b> {{this.soSubTotal}}</b> </label>

                                            <hr>
                                            <label class="mr-3">Total:<b> {{this.soSubTotal}}</b> </label>
                                        </div>
                                    </div> -->
                                    
                                    <div class=" border-200 text-right mr-6 mb-3 mt-3">
                                        <div class="text-lg blueText">
                                            SUB TOTAL: ₹ {{this.soSubTotal}}
                                        </div> <br>
                                        <div class="text-lg blueText">
                                            TOTAL: ₹ {{this.soSubTotal}}
                                        </div>
                                    </div>

                                </div>
                                <hr class="custom-hr">
                                <div class="flex gap-2 w-full">
                                    <div class="field col-5">
                                        <label class="mr-3  blueText">Terms Of Payments:</label>
                                        <p>{{this.activeOrder.termsOfPayments}}</p>
                                    </div>
                                    <div class="field col-5">
                                        <label class="mr-3 blueText">Terms Of Delivery:</label>
                                        <p>{{this.activeOrder.termsOfDelivery}}</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- <p-footer>
                                </p-footer> -->
                    </p-panel>
                </div>

            </div>

        </div>
    </div>
</div>

<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>