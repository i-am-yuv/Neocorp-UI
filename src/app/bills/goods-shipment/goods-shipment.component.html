<p-toast></p-toast>

<div class="">
    
    <div *ngIf="!createNew" class="m-6 border-round-3xl bg-white">
        <div class="center-container mt-1">
            <div class="field col-2"></div>
            <div class="field col-8">
                <div class="text-center">
                    <img src="/assets/RN.png" width="400" height="auto">
                </div>
                <div class="text-center">
                    <p><b>Ready to keep track of your financial transactions?</b></p> <br>
                    <p>Start by creating your first Goods Shipment.</p>
                </div>
                <div class="text-center mt-3">
                    <button type="button" pButton label="Create Goods Shipment" (click)="createGS()"
                        class="mb-3 text-lg Btn"></button>
                </div>
            </div>
            <div class="field col-2"></div>

        </div>
    </div>
    <!-- CREATE NEW DEBIT NOTE BUTTON ENDS -->

    <div *ngIf="createNew">
        <div class="bg-white flex">
            <div class="col-4 ">
                <p-breadcrumb class="max-w-full" [model]="items"></p-breadcrumb>
            </div>
            <!-- <div class="col-8">
                <div class="border-200 text-right p-3">
                    <button type="button" pButton label="Close" (click)="OnCancelGS()"
                        class="mr-3 p-button-secondary  "></button>
                    <button type="button" pButton label="Create Debit Note" (click)="finalGSSubmitPage()"
                        class=" mr-3 Btn "></button>
                </div>
            </div> -->
        </div>

        <div class="m-6 bg-white border-round-3xl">
            <form (ngSubmit)="onSubmitGS()" [formGroup]="gsForm" class="p-6">
                <h4 class="text-lg textColor">Goods Shipment Details </h4> <br>

                <div class="flex gap-3">
                    <div class="field col-6">
                        <label class="mr-3 required">Shipment Date</label>
                        <p-calendar formControlName="shipmentDate" [showIcon]="true" dateFormat="dd-mm-yy"
                            placeholder="Choose Shipmenr Date" [style]="{ width: '100%' }">
                        </p-calendar>
                        <error-message [controlName]="gsForm.controls['shipmentDate']"></error-message>
                    </div>
                    <div class="field col-6">
                        <label class="mr-3">Shipment Number:</label>
                        <input pInputText value="{{this.gsForm.value.documentno}}" placeholder="Your Shipment Number"
                            class="w-full custom-input" [disabled]="true" />
                    </div>

                </div>

                <div class="flex gap-3">
                    <div class="field col-6 payment-dropdown">
                        <label class="mr-3 required">Ship To</label>
                        <div class="payment-dropdown ">
                            <p-dropdown class="bg-slate-200" [options]="billTo" [style]="{ width: '100%' }"
                                placeholder="Please Select" optionLabel="name" optionValue="name"
                                formControlName="billToName" (onChange)="billToSelect()"></p-dropdown>
                        </div>
                    </div>

                    <div class="field col-6 " *ngIf="this.vendorVisible">
                        <label class="mr-3 required">Vendor</label>
                        <ng-container formGroupName="vendor" class="w-full">
                            <p-dropdown [options]="vendors" placeholder="Choose Vendor" optionValue="id"
                                formControlName="id" [showClear]="true" (onChange)="selectVendor()"
                                [style]="{ width: '100%' }" optionLabel="firstName">
                                <ng-template let-vendor pTemplate="option">
                                    <span class="font-semibold">{{ vendor.firstName }} {{ vendor.lastName
                                        }}</span><span>, (Mobile No: +91 {{vendor.mobileNumber}}) </span>
                                </ng-template>
                            </p-dropdown>
                        </ng-container>
                    </div>
                    <div class="field col-6 payment-dropdown" *ngIf="this.customerVisible">
                        <label class="mr-3 required">Customer</label>
                        <ng-container formGroupName="customer" class="w-full">
                            <p-dropdown [options]="customers" placeholder="Choose Customer" optionValue="id"
                                formControlName="id" [showClear]="true" (onChange)="selectVendor()"
                                [style]="{ width: '100%' }" optionLabel="displayName">
                                <ng-template let-customer pTemplate="option">
                                    <span class="font-semibold">{{ customer.displayName }}</span><span>, (Mobile No: +91 {{customer.mobileNumber}}) </span>
                                </ng-template>
                            </p-dropdown>
                        </ng-container>
                    </div>

                </div>

                <div class="flex w-full">
                    <div class="field col-6">
                        <label class="mr-3 ">Sales Order</label>
                        <ng-container formGroupName="salesOrder">
                            <div class="payment-dropdown ">
                                <p-dropdown [options]="allSo" placeholder="Choose Sales Order" optionValue="id"
                                    formControlName="id" optionLabel="orderNumber" [showClear]="true"
                                    (onChange)="selectSO($event)" [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </ng-container>
                    </div>
                </div>

                <div class="border-bottom-1 border-200 text-right p-3" *ngIf="!id">
                    <button type="submit" pButton label="Save" [disabled]="!gsForm.valid"
                        class="mb-6 text-lg Btn "></button>
                </div>
            </form>

            <div *ngIf="id" class="pl-5 pr-5">

                <div>
                    <p-table [value]="lineitems">
                        <ng-template pTemplate="header">
                            <tr>
                                <th class="text-blue-600">Item Detils</th>
                                <th class="text-blue-600">Price</th>
                                <th class="text-blue-600">Quantity</th>
                                <th class="text-blue-600">Discount</th>
                                <th class="text-blue-600">Total</th>
                            </tr>
                        </ng-template>
                        <ng-template let-lineItem pTemplate="body">
                            <tr>
                                <td>{{ lineItem.expenseName?.name }}</td>
                                <td>{{ lineItem.unitPrice }}</td>
                                <td>{{ lineItem.quantity }}</td>
                                <td>{{ lineItem.discount }}</td>
                                <td>{{ lineItem.amount }}</td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <div class=" border-200 text-right mr-6 mb-3 mt-3">
                        <div class="text-lg blueText">
                            SUB TOTAL: ₹ {{this.gsSubTotal}}
                        </div> <br>
                        <div class="text-lg blueText">
                            TOTAL: ₹ {{this.gsSubTotal}}
                        </div>
                    </div>
                </div>

                <form (ngSubmit)="onSubmitGSLine()" [formGroup]="gsLineForm" class="">
                    <h4 class="text-lg textColor">Line Items Details</h4>

                    <div class="flex mt-3 w-full">
                        <div class="field col-4">
                            <label class="mr-3 required ">Order Quantity</label>
                            <input pInputText [(ngModel)]="salesLineItemsTotal" formControlName="orderedQty" placeholder="Ordered Quantity" NumbersOnly
                                class="w-full custom-input" [max]="salesLineItemsTotal" />
                            <error-message [controlName]="gsLineForm.controls['orderedQty']"></error-message>
                        </div>
                        <div class="field col-4 required">
                            <label class="mr-3">Confirmed Quantity</label>
                            <input pInputText formControlName="confirmedQty" placeholder="Enter Confirmed Quantity"
                                class="w-full custom-input" NumbersOnly/>
                            <error-message [controlName]="gsLineForm.controls['confirmedQty']"></error-message>
                        </div>
                        <div class="field col-4 required">
                            <label class="mr-3">Shipped Quantity</label>
                            <input pInputText formControlName="shippedQty" placeholder="Enter Shipped Quantity"
                                class="w-full custom-input" NumbersOnly />
                            <error-message [controlName]="gsLineForm.controls['shippedQty']"></error-message>
                        </div>
                    </div>

                </form>


                <div class="border-bottom-1 border-200 text-right p-3">
                    <button type="button" pButton label="Close" (click)="OnCancelGS()"
                        class="mr-3 p-button-secondary"></button>
                    <button type="button" pButton label="Save Goods Shipment" (click)="onSubmitGSLine()"
                    [disabled]="!gsLineForm.valid"
                        class="mr-3 bg-blue-500 text-white px-4 py-2.5 rounded-md hover:bg-blue-600 "></button>
                </div>


            </div>

        </div>

    </div>
</div>

<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>