<p-toast></p-toast>
<div class="">

    <div *ngIf="!createNew" class="m-6 border-round-3xl bg-white">
        <div class="center-container mt-5 p-3 ">
            <div class="field col-3"></div>
            <div class="field col-6 ">
                <div class="image-container">
                    <img src="/assets/PoImage.png" alt="Image" class="w-full h-auto">
                </div>
                <div class="text-center">
                    <b>Streamline procurement with ease?</b><br>
                    <p>create your first purchase order today!</p>
                </div>
                <div class="text-center">
                    <button type="button" pButton label="Create Purchase Order" (click)="createPO()"
                        class="mb-3 text-lg p-button-raised bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800 "></button>
                </div>
            </div>
            <div class="field col-3"></div>
        </div>
    </div>

    <div *ngIf="createNew">
        <div class="bg-white iconSCSS1">
            <div class="col-4">
                <p-breadcrumb class="max-w-full" [model]="items"></p-breadcrumb>
            </div>
            <div class="col-8">
                <div class=" border-200 text-right">
                    <button type="button" pButton label="Cancel" (click)="OnCancelPO()"
                        class="mr-3 p-button-secondary"></button>
                    <button type="button" pButton label="Save Purchase Order" (click)="finalPoSubmitPage()"
                        [disabled]="this.poSubTotal == 0"
                        class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800 "></button>
                </div>
            </div>
            <div class="col-8">
                <div class=" border-200 text-right p-3">
                    <button type="button" pButton label="Cancel" (click)="OnCancelPO()"
                        class="mr-3 p-button-secondary"></button>
                    <button type="button" pButton label="Save Purchase Order" (click)="finalPoSubmitPage()"
                        [disabled]="this.poSubTotal == 0"
                        class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800 "></button>
                </div>
            </div>
            
        </div>

        <div class="m-6 bg-white border-round-3xl">
            <form (ngSubmit)="onSubmitPO()" [formGroup]="poForm" class="p-6">
                <div class="flex gap-2">

                    <!-- <div class="field col-6 payment-dropdown">
                        <label class="mr-3 required">Bill To</label>
                        <div class="payment-dropdown ">
                            <p-dropdown class="bg-slate-200" [options]="billTo" [style]="{ width: '100%' }"
                                placeholder="Please Select" optionLabel="name" optionValue="name"
                                formControlName="billToName" (onChange)="billToSelect()"></p-dropdown>
                        </div>
                    </div> -->

                    <div class="field col-6 ">
                        <label class="mr-3 required">Vendor</label>
                        <ng-container formGroupName="vendor" class="w-full">
                            <p-dropdown [options]="vendors" placeholder="Choose Vendor" optionValue="id"
                                formControlName="id" optionLabel="firstName" [showClear]="true"
                                (onChange)="selectVendor()" [style]="{ width: '100%' }">
                            </p-dropdown>
                        </ng-container>
                    </div>
                    <!-- <div class="field col-6 payment-dropdown" *ngIf="this.customerVisible">
                        <label class="mr-3 required">Customer</label>
                        <ng-container formGroupName="customer" class="w-full">
                            <div class="payment-dropdown ">
                                <p-dropdown [options]="customers" placeholder="Choose Customer" optionValue="id"
                                    formControlName="id" optionLabel="displayName" [showClear]="true"
                                    (onChange)="selectVendor()" [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </ng-container>
                    </div> -->
                </div>

                <hr class="border-gray-50 mt-3 mb-3">

                <h4 class="blueText"><b>Purchase Order Details</b></h4>

                <div class="flex gap-2">
                    <div class="field col-6">
                        <label class="mr-3">Purchase Order Number:</label>
                        <!-- <h3>{{ this.poForm.value.orderNumber }}</h3> -->
                        <input pInputText value="{{this.poForm.value.orderNumber}}" placeholder="Your Order Number"
                            class="w-full custom-input " [disabled]="true" />
                    </div>

                    <!-- <div class="field col-4">
                        <label class="mr-3 required">Order Status</label>
                        <input pInputText formControlName="status" placeholder="Enter Status"
                            class="w-full custom-input" />
                        <error-message [controlName]="poForm.controls['status']"></error-message>
                    </div> -->

                    <div class="field col-6">
                        <label class="mr-3 required">Place Of Supply</label><br>
                        <ng-container formGroupName="placeOfSupply" class="w-full">
                            <div class="payment-dropdown ">
                                <p-dropdown [options]="states" placeholder="Choose State" optionValue="id"
                                    formControlName="id" optionLabel="stateName" [showClear]="true"
                                    (onChange)="selectVendor()" [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                        </ng-container>
                    </div>
                </div>

                <div class="flex gap-3 ">

                    <div class="field col-6">
                        <label class="mr-3 required">Order Date</label><br>
                        <p-calendar formControlName="orderDate" [showIcon]="true" dateFormat="dd-mm-yy"
                            placeholder="Choose Order Date" [style]="{ width: '100%' }">
                        </p-calendar>
                        <error-message [controlName]="poForm.controls['orderDate']"></error-message>
                    </div>

                    <div class="field col-6 ">
                        <label class="mr-3 required">Due Date</label><br>
                        <p-calendar formControlName="dueDate" [showIcon]="true" dateFormat="dd-mm-yy"
                            placeholder="Choose Due Date" [style]="{ width: '100%' }">
                        </p-calendar>
                        <error-message [controlName]="poForm.controls['dueDate']"></error-message>
                    </div>
                </div>

                <div class="flex ">
                    <div class="field col-12">
                        <label class="mr-3 ">Description</label>
                        <input pInputText formControlName="description"
                            placeholder="Enter Your Purchase Order Description" class="w-full custom-input" />
                        <error-message [controlName]="poForm.controls['description']"></error-message>
                    </div>
                </div>

                <div class="flex gap-1 ">
                    <div class="field col-12">
                        <label class="mr-3">Internsl Notes</label>
                        <input pInputText formControlName="internslNotes"
                            placeholder="Enter Your internal Notes Of Purchase Order" class="w-full custom-input" />
                        <error-message [controlName]="poForm.controls['internslNotes']"></error-message>
                    </div>
                </div>

                <!-- <hr class="border-gray-50 mt-3 mb-3"> -->

                <div class="flex gap-2 ">
                    <div class="field col-4">
                        <label class="mr-3">Enable Partial Payments</label>
                        <p-toggleButton onLabel="Confirm" offLabel="Reject"
                            formControlName="enablePartialPayments"></p-toggleButton>
                    </div>
                </div>

                <div class="border-bottom-1 border-200 text-right p-3" *ngIf="!id">
                    <button type="submit" pButton label="Save" [disabled]="!poForm.valid"
                        class="mb-6 text-lg p-button-raised bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-600 "></button>
                </div>

            </form>

            <div *ngIf="id" class="p-1">
                <p-table #dt [value]="lineitems" dataKey="id" editMode="row" styleClass="">
                    <ng-template pTemplate="header">
                        <tr>
                            <th class="text-center" width="100">Product</th>
                            <th class="text-center" width="100">Price</th>
                            <th class="text-center" width="100">Quantity</th>
                            <th class="text-center" width="100">Discount (₹)</th>
                            <th class="text-center" width="100">Total</th>
                            <th width="150" *ngIf="!viewOnly" class="text-right">
                                <button pButton label="Add Item" icon="pi pi-plus"
                                    class="p-button-secondary p-button-outlined mr-3" (click)="enableRowSubmit()"
                                    (click)="newRecord = !newRecord" pAddRow [table]="dt" [newRow]="newRow()"
                                    [inProgress]="newRecord" [disabled]="newRecord"></button>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-lineItem let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="lineItem">
                            <td class="text-center">
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-dropdown [options]="products" [(ngModel)]="lineItem.expenseName.id"
                                            placeholder="Choose Product" optionValue="id" optionLabel="name"
                                            [showClear]="true" (ngModelChange)="setLineValues(lineItem)">
                                        </p-dropdown>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{ lineItem?.expenseName?.name }}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td class="text-center">
                                <!-- {{ lineItem?.unitprice | number : "1.2-2" }} -->
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-inputNumber [(ngModel)]="lineItem.unitPrice"
                                            (onInput)="setLineQtyValuesPrice($event, lineItem)" [format]="false"
                                            [required]="true">
                                        </p-inputNumber>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{ lineItem?.unitPrice }}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td class="text-center">
                                <!-- {{ lineItem?.quantity | number : "1.2-2" }} -->
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-inputNumber [(ngModel)]="lineItem.quantity"
                                            (onInput)="setLineQtyValuesQuantity($event, lineItem)" [format]="false"
                                            [required]="true">
                                        </p-inputNumber>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{ lineItem?.quantity }}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td class="text-center">
                                <!-- {{ lineItem?.discount | number : "1.2-2" }} -->
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <p-inputNumber [(ngModel)]="lineItem.discount"
                                            (onInput)="setLineQtyValuesDiscount($event, lineItem)" [format]="false"
                                            [required]="true">
                                        </p-inputNumber>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{ lineItem?.discount }}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td class="text-center">
                                {{ ((lineItem?.unitPrice)*(lineItem?.quantity))-(lineItem?.discount) | number :
                                "1.2-2" }}
                            </td>
                            <td *ngIf="!viewOnly" class="text-right">
                                <div>
                                    <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                        icon="pi pi-pencil" (click)="onRowEditInit(lineItem)"
                                        class="p-button-rounded p-button-text"></button>
                                    <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow
                                        icon="pi pi-trash" (click)="delete(lineItem)"
                                        class="p-button-rounded p-button-text p-button-danger"></button>
                                    <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow
                                        icon="pi pi-check" (click)="onRowEditSave(lineItem)"
                                        class="p-button-rounded p-button-text p-button-success mr-2"
                                        [disabled]="!isquantity"></button>
                                    <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow
                                        icon="pi pi-times" (click)="onRowEditCancel(lineItem, ri)"
                                        class="p-button-rounded p-button-text p-button-danger"></button>
                                </div>
                            </td>
                        </tr>

                        <!-- <p-dialog header="Header" [(visible)]="DeleteDialLogvisible" [style]="{ width: '50vw' }">
                            <ng-template pTemplate="header">
                                <span class="text-xl font-bold">Confirmation</span>
                            </ng-template>
                            <p>
                                Are you sure you want to delete this Line Item?
                            </p>
                            <ng-template pTemplate="footer">
                                <p-button icon="pi pi-times" (click)="cancelDeleteConfirm()" label="Cancel" styleClass="p-button-text"></p-button>
                                <p-button icon="pi pi-check" (click)="deleteConfirm(lineItem)" label="Yes" styleClass="p-button-text"></p-button>
                            </ng-template>
                        </p-dialog> -->

                        <p-dialog header="Header" [(visible)]="DeleteDialLogvisible" [modal]="true"
                            [style]="{ width: '30vw' }" [draggable]="false" [resizable]="false">
                            <ng-template pTemplate="header">
                                <span class="text-xl font-bold">Confirmation</span>
                            </ng-template>
                            <p class="m-0">Are you sure you want to delete this Line Item?</p>
                            <ng-template pTemplate="footer">
                                <p-button icon="pi pi-times" (click)="cancelDeleteConfirm()" label="Cancel"
                                    styleClass="p-button-text"></p-button>
                                <p-button icon="pi pi-check" (click)="deleteConfirm(lineItem)" label="Yes"
                                    styleClass="p-button-text"></p-button>
                            </ng-template>
                        </p-dialog>

                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8">
                                <div class="text-center m-5">
                                    No purchase order line Items found create one.
                                </div>
                            </td>
                        </tr>
                    </ng-template>

                </p-table>

                <!-- <div class="flex gap-5 mt-5">
                    <div class="field col-1"></div>
                    <div class="field col-4">
                        <label for="file">Upload File :</label><br>
                        <input type="file" name="file" (change)="selectFile($event)" accept="image/*" class="mt-2"
                            chooseLabel="Upload File" />
                    </div>
                </div> -->


                <div class="flex gap-5 mt-5">
                    <div class="field col-1"></div>
                    <div class="field col-4">
                        <label for="fileInput" class="image-upload-label">
                            <img src="/assets/uploadFile.png" alt="Upload Image" class="ml-2 mt-2 w-11">
                        </label>
                        <input type="file" id="fileInput" name="file" accept="image/*" class="hidden"
                            (change)="selectFile($event)">
                        <span id="selectedFileName" class="ml-2"></span>
                    </div>
                </div>


                <!-- <div class="flex">
                                <div class="field col-12 text-right w-full">
                                    <button type="button" pButton label="Create Purchase Order"
                                        [disabled]="this.poSubTotal == 0" (click)="finalPoSubmitPage()"
                                        class="mb-6 p-button-raised bg-blue-500 text-white px-4 py-2.5 rounded-md hover:bg-blue-600 "></button>
                                </div>
                            </div> -->


                <div class=" border-200 text-right mr-6 mb-3">
                    <div class="text-xl ">
                        SUB TOTAL: ₹ {{this.poSubTotal}}
                    </div> <br>
                    <div class="text-xl">
                        TOTAL: ₹ {{this.poSubTotal}}
                    </div>
                </div>


                <div class="border-bottom-1 border-200 text-right p-3">
                    <button type="button" pButton label="Cancel" (click)="OnCancelPO()"
                        class="mr-3 p-button-secondary"></button>
                    <button type="button" pButton label="Save Purchase Order" (click)="finalPoSubmitPage()"
                        [disabled]="this.poSubTotal == 0"
                        class="mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800 "></button>
                </div>

            </div>
        </div>

    </div>


</div>


<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>