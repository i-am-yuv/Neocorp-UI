<p-toast></p-toast>

<div class="">
    <div class="bg-white flex">
        <div class="col-4 py-3">
            <p-breadcrumb class="max-w-full" [model]="items"></p-breadcrumb>
        </div>
        <div class="col-8">
            <div class="border-200 text-right p-3">
                <button type="button" pButton (click)="CreateNewReceiptNote()"
                    class=" mr-3 bg-blue-700 text-white px-4 py-2.5 rounded-md hover:bg-blue-800  ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="mr-2" viewBox="0 0 20 20"
                        fill="none">
                        <path
                            d="M17.5 10C17.5 10.1658 17.4342 10.3247 17.3169 10.4419C17.1997 10.5592 17.0408 10.625 16.875 10.625H10.625V16.875C10.625 17.0408 10.5592 17.1997 10.4419 17.3169C10.3247 17.4342 10.1658 17.5 10 17.5C9.83424 17.5 9.67527 17.4342 9.55806 17.3169C9.44085 17.1997 9.375 17.0408 9.375 16.875V10.625H3.125C2.95924 10.625 2.80027 10.5592 2.68306 10.4419C2.56585 10.3247 2.5 10.1658 2.5 10C2.5 9.83424 2.56585 9.67527 2.68306 9.55806C2.80027 9.44085 2.95924 9.375 3.125 9.375H9.375V3.125C9.375 2.95924 9.44085 2.80027 9.55806 2.68306C9.67527 2.56585 9.83424 2.5 10 2.5C10.1658 2.5 10.3247 2.56585 10.4419 2.68306C10.5592 2.80027 10.625 2.95924 10.625 3.125V9.375H16.875C17.0408 9.375 17.1997 9.44085 17.3169 9.55806C17.4342 9.67527 17.5 9.83424 17.5 10Z"
                            fill="white" />
                    </svg> Create New Receipt Note
                </button>
            </div>
        </div>
        
    </div>

    <div class="m-6 bg-white border-round-3xl">
        <div class="p-5">
            <div class="flex gap-4" style=" justify-content: center;">

                <div class="col-5">
                    <p-panel class="left-panel ">
                        <ng-template pTemplate="header">
                            <span class="p-panel-title" style="padding: 1px">Sent to</span>
                        </ng-template>
                        <ng-template pTemplate="content">
                            <div class="left-panel-content">
                                <br />
                                <div *ngFor="let item of allReceiptNotes" class="order-list"
                                    [ngClass]="{ 'bg-gray-100': activeRN.id === item.id }">
                                    <div class="list-item" (click)="changeOrder(item)">
                                        <div class="iconSCSS w-full gap-2 p-3">
                                            <div class=" col-2  justify-center align-center">
                                                <div class="person-icon">{{
                                                    item.vendor?.firstName.charAt(0) +
                                                    item.vendor?.lastName.charAt(0) }}</div>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-base"><b>{{ item.receiptNoteNumber }}</b></div>
                                                <div class="flex gap-2 " *ngIf="item.vendor">
                                                    <div class="col-8 font-italic text-base">
                                                        {{ item.vendor?.firstName }} {{ item.vendor?.lastName }}
                                                    </div>
                                                    <div class="col-4   text-base text-right">
                                                        <b>₹: </b>{{item.grossTotal}}
                                                    </div>
                                                </div>
                                                <div class="flex gap-2" *ngIf="item.customer">
                                                    <div class="col-8 font-italic text-base ">
                                                        {{ item.customer?.displayName }}
                                                    </div>
                                                    <div class="col-4 text-base text-right ">
                                                        <b>₹: </b>{{item.grossTotal}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center m-5" *ngIf="allReceiptNotes.length === 0">
                                    No Receipt Note Available
                                </div>
                            </div>
                        </ng-template>
                        <p-footer> Total: {{ this.totalRecords}} </p-footer>
                    </p-panel>
                </div>

                <div class="col-7">
                    <p-panel>
                        <ng-template pTemplate="header">
                            <div class="w-full">
                                <div class="grid m-0">
                                    <div class="col-6 p-0">
                                        <span class="p-panel-title">Receipt Note</span>
                                    </div>
                                </div>
                            </div>

                        </ng-template>
                        <div class="right-panel-content">
                            <div class="text-center m-5" *ngIf="!activeRN.id && allReceiptNotes.length > 0">
                                <img src="/assets/invoices.png" width="400"><br>
                                <p class="mt-4 text-xl">Please, Select Receipt Note</p>
                            </div>
                            <div class="text-center m-5" *ngIf="allReceiptNotes.length === 0">
                                No Receipt Note Found, Please Create One
                            </div>
                            <div *ngIf="activeRN.id">
                                <!-- <h3 class="text-lg ">Purchase Order Details</h3>
                                        <br> -->
                                <div class="flex bg-gray-700 gap-3 rounded-div1 mr-3 p-2 ">
                                    <div class="field col-7  ml-3 ">
                                        <h4 class="rightMain">Payment Activity</h4>
                                        <h4 class="text-white">#{{this.activeRN.receiptNoteNumber}}
                                        </h4>

                                        <div class="flex gap-5 bg-white rounded-div1 mt-3 ">
                                            <div class="field col-6">
                                                <h5>Current Due</h5>
                                                <h4 class="remainAmount text-xl">₹ {{this.currentDue}}</h4>
                                            </div>
                                            <div class="field col-6">
                                                <h5>Total Amount</h5>
                                                <h4 class="text-xl">₹ {{this.activeRN.grossTotal}}</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="field col-4 bg-gray-700">
                                        <div *ngIf="this.activeRN.status!='COMPLETED'"
                                            class=" bg-red-100 mt-2 ml-2 mr-2 rounded-div1">
                                            <h4 class="text-center leftStatus text-base  ">
                                                <div class="flex gap-1  w-full">
                                                    <div class="col-3 leftP text-right">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                            viewBox="0 0 18 18" fill="none">
                                                            <path
                                                                d="M9 15.75C7.66498 15.75 6.35993 15.3541 5.2499 14.6124C4.13987 13.8707 3.27471 12.8165 2.76382 11.5831C2.25292 10.3497 2.11925 8.99252 2.3797 7.68314C2.64015 6.37377 3.28303 5.17104 4.22703 4.22703C5.17104 3.28303 6.37377 2.64015 7.68314 2.3797C8.99251 2.11925 10.3497 2.25292 11.5831 2.76382C12.8165 3.27471 13.8707 4.13987 14.6124 5.2499C15.3541 6.35994 15.75 7.66498 15.75 9C15.75 10.7902 15.0388 12.5071 13.773 13.773C12.5071 15.0388 10.7902 15.75 9 15.75ZM9 3.21429C7.8557 3.21429 6.73709 3.55361 5.78563 4.18936C4.83418 4.8251 4.09261 5.72871 3.6547 6.78591C3.21679 7.84311 3.10222 9.00642 3.32546 10.1287C3.5487 11.2511 4.09974 12.282 4.90888 13.0911C5.71803 13.9003 6.74895 14.4513 7.87127 14.6745C8.99358 14.8978 10.1569 14.7832 11.2141 14.3453C12.2713 13.9074 13.1749 13.1658 13.8106 12.2144C14.4464 11.2629 14.7857 10.1443 14.7857 9C14.7857 7.46554 14.1761 5.99392 13.0911 4.90889C12.0061 3.82385 10.5345 3.21429 9 3.21429Z"
                                                                fill="#C22B39" />
                                                            <path
                                                                d="M10.6457 12.75L8.25 9.95501V5.25H9.10714V9.54001L11.25 12.045L10.6457 12.75Z"
                                                                fill="#C22B39" />
                                                        </svg>
                                                    </div>
                                                    <div class="col-9 rightP text-left">
                                                        {{this.activeRN.status}}
                                                    </div>
                                                </div>
                                            </h4>
                                        </div>
                                        <div *ngIf="this.activeRN.status=='COMPLETED'"
                                            class=" bg-green-300 mt-2 ml-2 mr-2 rounded-div1">
                                            <!-- <h4 class="text-center text-base leftStatus ">Status:
                                                {{this.activeInvoice.status}}
                                            </h4> -->
                                            <h4 class="text-center leftStatus text-base ">
                                                <div class="flex gap-1  w-full">
                                                    <div class="col-3 leftP text-right">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                            viewBox="0 0 32 32" fill="none">
                                                            <path
                                                                d="M30.4099 8.53003L27.4099 5.58503C27.0351 5.21176 26.5277 5.0022 25.9987 5.0022C25.4697 5.0022 24.9623 5.21176 24.5874 5.58503L12.9999 17L12.9862 16.9863L8.40619 12.5775C8.03043 12.2056 7.5227 11.9977 6.99402 11.9991C6.46534 12.0005 5.95873 12.2111 5.58494 12.585L2.58494 15.585C2.21054 15.96 2.00024 16.4683 2.00024 16.9982C2.00024 17.5281 2.21054 18.0363 2.58494 18.4113L11.5374 27.4113C11.7232 27.597 11.9437 27.7444 12.1863 27.8449C12.429 27.9455 12.6891 27.9972 12.9518 27.9972C13.2145 27.9972 13.4746 27.9455 13.7173 27.8449C13.96 27.7444 14.1805 27.597 14.3662 27.4113L30.4162 11.3638C30.6023 11.1776 30.7498 10.9564 30.8503 10.713C30.9507 10.4697 31.0021 10.2089 31.0015 9.9456C31.0009 9.68232 30.9484 9.42175 30.8469 9.17883C30.7453 8.93591 30.5969 8.71543 30.4099 8.53003ZM12.9524 26L3.99994 17L6.99994 14L7.01369 14.0138L11.5937 18.4225C11.9682 18.7935 12.474 19.0016 13.0012 19.0016C13.5283 19.0016 14.0342 18.7935 14.4087 18.4225L26.0074 7.00003L28.9999 9.95003L12.9524 26Z"
                                                                fill="#343330" />
                                                        </svg>
                                                    </div>
                                                    <div class="col-9 rightP text-left">
                                                        {{this.activeRN.status}}
                                                    </div>
                                                </div>
                                            </h4>
                                        </div>
                                        <div>
                                            <div class="mt-5">
                                                <h5 class="text-white">Start Date: {{ this.activeRN.startDate |
                                                    date:'yyyy-MM-dd' }}</h5>
                                                <hr class="custom-hr">
                                                <h5 class="text-white">End Date: {{ this.activeRN.endDate |
                                                    date:'yyyy-MM-dd' }}</h5>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- <div class="flex mt-3">
                                    <div class="field col-8">
                                        <h4 class="text-blue-700">Purchase Invoice Details:</h4>
                                    </div>
                                    <div class="field col-4 text-right">
                                        <button pButton type="button" icon="pi pi-pencil"
                                            (click)="onEditPI(activeInvoice.id)"></button>
                                    </div>
                                </div>
                                <div class="flex">
                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Purchase Invoice:</label>
                                        <p><b>#{{ this.activeRN.invoiceNo}}</b></p>
                                    </div>

                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Invoice Date:</label>
                                        <p>{{ this.activeRN.invoiceDate | date:'yyyy-MM-dd' }}</p>
                                    </div>

                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Due Date:</label>
                                        <p>{{ this.activeRN.duedate | date:'yyyy-MM-dd' }}</p>
                                    </div>
                                </div>
                                <hr class="custom-hr">
                                <div class="flex">
                                    <div class="field col-11">
                                        <label class="mr-3 blueText">Purchase Order Details:</label>
                                        <p class="text-sm"><b>Purchase Order Number: #
                                                {{this.activeRN.purchaseOrder?.orderNumber}}</b>
                                        </p>
                                    </div>
                                </div> -->
                                <!-- <hr class="custom-hr"> -->


                                <div *ngIf="this.activeRN.vendor">
                                    <div class="flex">
                                        <div class="field col-8">
                                            <h4 class="">Vendor Details:</h4>
                                        </div>
                                        <div class="iconSCSS w-full gap-1 mr-3 cursor-pointer" (click)="onEditRN(activeRN.id)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22"
                                                viewBox="0 0 10 11" fill="none">
                                                <g clip-path="url(#clip0_862_17281)">
                                                    <path
                                                        d="M7.0257 2.11389L7.72882 1.37075C8.03392 1.04829 8.52858 1.04829 8.83368 1.37075C9.13877 1.69321 9.13877 2.21602 8.83368 2.53848L4.40924 7.21469C4.18896 7.44751 3.91726 7.61864 3.6187 7.71264L2.5 8.06485L2.83324 6.88249C2.92218 6.56694 3.0841 6.27978 3.30438 6.04697L7.0257 2.11389ZM7.0257 2.11389L8.125 3.27574M7.5 6.30334V8.39513C7.5 8.94236 7.08027 9.38598 6.5625 9.38598H2.1875C1.66973 9.38598 1.25 8.94236 1.25 8.39513V3.77117C1.25 3.22394 1.66973 2.78032 2.1875 2.78032H4.16667"
                                                        stroke="#6F7174" stroke-width="0.625" stroke-linecap="round"
                                                        stroke-linejoin="round" />
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_862_17281">
                                                        <rect width="10" height="10.5691" fill="white"
                                                            transform="translate(0 0.138184)" />
                                                    </clipPath>
                                                </defs>
                                            </svg>
                                            <div class="text-sm font-light">Edit Receipt Note</div>
                                        </div>
                                    </div>

                                    <div class="flex">
                                        <div class="field col-3">
                                            <label class="mr-3 blueText">Vendor Name</label>
                                            <p>{{ this.activeRN.vendor.firstName}} {{this.activeRN.vendor.lastName}}</p>
                                        </div>

                                        <div class="field col-3">
                                            <label class="mr-3 blueText">Mobile Number</label>
                                            <p>{{ this.activeRN.vendor.mobileNumber}}</p>
                                        </div>

                                        <div class="field col-5">
                                            <label class="mr-3  blueText">Address</label><br>
                                            <p>{{this.activeRN.vendor.address?.billingName}}</p>
                                            <p>{{this.activeRN.vendor.address?.billingAddress}}</p>
                                            <p>{{this.activeRN.vendor.address?.city}}
                                                ,{{this.activeRN.vendor.address?.pincode}}</p>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="this.activeRN.customer">
                                    <div class="flex">
                                        <div class="field col-8">
                                            <h4 class="">Customer Details:</h4>
                                        </div>
                                        <div class="iconSCSS w-full gap-1 mr-3 cursor-pointer" (click)="onEditRN(activeRN.id)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22"
                                                viewBox="0 0 10 11" fill="none">
                                                <g clip-path="url(#clip0_862_17281)">
                                                    <path
                                                        d="M7.0257 2.11389L7.72882 1.37075C8.03392 1.04829 8.52858 1.04829 8.83368 1.37075C9.13877 1.69321 9.13877 2.21602 8.83368 2.53848L4.40924 7.21469C4.18896 7.44751 3.91726 7.61864 3.6187 7.71264L2.5 8.06485L2.83324 6.88249C2.92218 6.56694 3.0841 6.27978 3.30438 6.04697L7.0257 2.11389ZM7.0257 2.11389L8.125 3.27574M7.5 6.30334V8.39513C7.5 8.94236 7.08027 9.38598 6.5625 9.38598H2.1875C1.66973 9.38598 1.25 8.94236 1.25 8.39513V3.77117C1.25 3.22394 1.66973 2.78032 2.1875 2.78032H4.16667"
                                                        stroke="#6F7174" stroke-width="0.625" stroke-linecap="round"
                                                        stroke-linejoin="round" />
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_862_17281">
                                                        <rect width="10" height="10.5691" fill="white"
                                                            transform="translate(0 0.138184)" />
                                                    </clipPath>
                                                </defs>
                                            </svg>
                                            <div class="text-sm font-light">Edit Receipt Note</div>
                                        </div>
                                    </div>
                                    <div class="flex">
                                        <div class="field col-3">
                                            <label class="mr-3 blueText">Customer Name</label>
                                            <p>{{ this.activeRN.customer.displayName}}</p>
                                        </div>

                                        <div class="field col-3">
                                            <label class="mr-3 blueText">Mobile Number</label>
                                            <p>{{ this.activeRN.customer.mobileNumber}}</p>
                                        </div>
                                        <div class="field col-5">
                                            <label class="mr-3  blueText">Address</label><br>
                                            <p>{{this.activeRN.customer.address?.billingName}}</p>
                                            <p>{{this.activeRN.customer.address?.billingAddress}}</p>
                                            <p>{{this.activeRN.customer.address?.city}}
                                                ,{{this.activeRN.customer.address?.pincode}}</p>
                                        </div>
                                    </div>
                                </div>


                                <hr class="custom-hr">

                                <div class="flex gap-2">
                                    <div class="field col-7">
                                        <label class="mr-3 blueText">Bill From:</label>
                                        <p>{{this.activeRN.vendor?.address?.billingName}}</p>
                                        <p>{{this.activeRN.vendor?.address?.billingAddress}}</p>
                                        <p>{{this.activeRN.vendor?.address?.city}}
                                            ,{{this.activeRN.vendor?.address?.pincode}}</p>
                                    </div>
                                    <div class="field col-4">
                                        <label class="mr-3 blueText">Place Of Supply</label>
                                        <p>{{this.activeRN.placeOfSupply?.stateName}}</p><br>
                                    </div>
                                </div>
                                <div>
                                    <p-table [value]="lineitems">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th class="text-blue-600">Item Detils</th>
                                                <th class="text-blue-600">Price</th>
                                                <th class="text-blue-600">Quantity</th>
                                                <th class="text-blue-600">Discount</th>
                                                <th class="text-blue-600">Total</th>
                                            </tr>
                                        </ng-template>
                                        <ng-template let-lineItem pTemplate="body">
                                            <tr>
                                                <td>{{ lineItem.expenseName?.name }}</td>
                                                <td>{{ lineItem.unitPrice }}</td>
                                                <td>{{ lineItem.quantity }}</td>
                                                <td>{{ lineItem.discount }}</td>
                                                <td>{{ lineItem.amount }}</td>
                                            </tr>
                                        </ng-template>
                                    </p-table>

                                    <div class=" border-200 text-right mr-6 mb-3 mt-3">
                                        <div class="text-lg blueText">
                                            SUB TOTAL: ₹ {{this.rnSubTotal}}
                                        </div> <br>
                                        <div class="text-lg blueText">
                                            TOTAL: ₹ {{this.rnSubTotal}}
                                        </div>
                                    </div>

                                </div>
                                <hr class="custom-hr">
                                <div class="flex">
                                    <div class="field col-4">
                                        <label class="blueText">Client Notes:</label>
                                        <p>{{this.activeRN.clientNotes}}</p>
                                    </div>
                                    <div class="field col-4">
                                        <label class="blueText">Description:</label>
                                        <p>{{this.activeRN.description}}</p>
                                    </div>
                                    <div class="field col-4">
                                        <label class="blueText">Internal Notes:</label>
                                        <p>{{this.activeRN.internalNotes}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </p-panel>
                </div>
            </div>
        </div>
    </div>
</div>

<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>