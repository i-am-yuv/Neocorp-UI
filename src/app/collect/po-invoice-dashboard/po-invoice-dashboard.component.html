<p-toast></p-toast>
<div class="bg-white">
    <div class="raised-container">
        <div class="flex bg-gray-300 button-container">
            <button type="button" pButton label="+ Create PI" (click)="CreateNewPI()"
                class="mt-3  text-lg mr-3 mb-3 p-button-raised bg-blue-500 text-white px-4 py-2.5 rounded-md hover:bg-blue-600 "></button>
        </div>
    </div>

    <div>
        <div class="padFlex flex gap-5">
            <div class="col-5 raised-container bg-white ">
                <p-panel class="left-panel ">
                    <ng-template pTemplate="header">
                        <span class="p-panel-title" style="padding: 1px">All Purchase Invoices</span>
                    </ng-template>
                    <ng-template pTemplate="content">
                        <div class="left-panel-content">
                            <br />
                            <!-- <div class="left-panel-content"> -->
                            <div *ngFor="let item of allPIs" class="order-list"
                                [ngClass]="{ 'bg-gray-100': activeInvoice.id === item.id }">
                                <div class="mt-3 list-item" (click)="changeOrder(item)">
                                    <div class="flex justify-center">
                                        <div class="field col-2">
                                            <div class="ml-3 mb-2 mt-2 person-icon">{{
                                                item.vendor?.firstName.charAt(0) +
                                                item.vendor?.lastName.charAt(0) }}</div>
                                        </div>
                                        <div class="field col-8">
                                            <div class="text-base ml-3"><b>{{ item.orderNumber }}</b></div>
                                            <div class="flex gap-4 " *ngIf="item.vendor">
                                                <div class="col-6 font-italic text-base mt-2 mb-2 ml-3">
                                                    {{ item.vendor?.firstName }} {{ item.vendor?.lastName }}
                                                </div>
                                                <div class="col-4 text-base mt-2 mb-2">
                                                    <b>₹: </b>{{item.grossTotal}}
                                                </div>
                                            </div>
                                            <div class="flex gap-4" *ngIf="item.customer">
                                                <div class="col-6 font-italic text-base mt-2 mb-2 ml-3">
                                                    {{ item.customer?.displayName }}
                                                </div>
                                                <div class="col-4 text-base mt-2 mb-2 ">
                                                    <b>₹: </b>{{item.grossTotal}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                            <div class="text-center m-5" *ngIf="allPIs.length === 0">
                                No Purchase Invoice Available
                            </div>
                        </div>
                    </ng-template>
                    <p-footer> Total: {{ this.totalRecords}} </p-footer>
                </p-panel>
            </div>

            <div class="col-6 raised-container bg-white ">
                <p-panel>
                    <ng-template pTemplate="header">
                        <div class="w-full">
                            <div class="grid m-0">
                                <div class="col-6 p-0">
                                    <span class="p-panel-title">Purchase Invoice</span>
                                </div>
                            </div>
                        </div>

                    </ng-template>
                    <div class="right-panel-content">
                        <div class="text-center m-5" *ngIf="!activeInvoice.id">
                            <img src="assets/empty.svg" width="250" /><br />
                            Select Purchase Invoice
                        </div>
                        <div *ngIf="activeInvoice.id">
                            <!-- <h3 class="text-lg ">Purchase Order Details</h3>
                                    <br> -->
                            <div class="flex bg-gray-700 gap-3 rounded-div1 mr-3 p-2 ">
                                <div class="field col-7  ml-3 ">
                                    <h4 class="text-gray-200">Payment Activity</h4>
                                    <h4 class="text-white">#{{this.activeInvoice.purchaseOrder?.orderNumber}}
                                    </h4>

                                    <div class="flex gap-5 bg-white rounded-div mt-3 justify-center">
                                        <div class="field col-6 ml-3">
                                            <h5>Current Due</h5>
                                            <h4 class="text-red-700 text-lg"><b>₹ {{this.currentDue}}</b></h4>
                                        </div>
                                        <div class="field col-6">
                                            <h5>Total Amount</h5>
                                            <h4 class="text-lg"><b>₹ {{this.activeInvoice.grossTotal}}</b></h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="field col-4 bg-gray-700">
                                    <div class=" bg-red-400 rounded-div mt-2">
                                        <h4 class="text-white text-center">Status: {{this.activeInvoice.status}}</h4>
                                    </div>
                                    <div>
                                        <div class="mt-4">
                                            <h5 class="text-white">Invoice Date: {{ this.activeInvoice.invoiceDate |
                                                date : "short"}}</h5>
                                            <hr class="border-gray-200">
                                            <h5 class="text-white">Due Date: {{ this.activeInvoice.duedate | date :
                                                "short"}}</h5>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="flex mt-3">
                                <div class="field col-8">
                                    <h4 class="text-blue-700">Purchase Invoice Details:</h4>
                                </div>
                                <div class="field col-4 text-right">
                                    <button pButton type="button" icon="pi pi-pencil"
                                        (click)="onEditPI(activeInvoice.id)"></button>
                                </div>
                            </div>
                            <div class="flex">
                                <div class="field col-4">
                                    <label class="mr-3 text-blue-500">Purchase Invoice:</label>
                                    <h5>#{{ this.activeInvoice.invoiceNo}}</h5>
                                </div>

                                <div class="field col-4">
                                    <label class="mr-3 text-blue-500">Invoice Date:</label>
                                    <h5>{{ this.activeInvoice.invoiceDate | date : "short"}}</h5>
                                </div>

                                <div class="field col-4">
                                    <label class="mr-3 text-blue-500">Due Date:</label>
                                    <h5>{{ this.activeInvoice.duedate | date : "short"}}</h5>
                                </div>
                            </div>
                            <hr class="border-l-neutral-600">
                            <div class="flex">
                                <div class="field col-6">
                                    <label class="mr-3 text-blue-500">Purchase Order</label>
                                    <h4>Order Number: {{this.activeInvoice.purchaseOrder?.orderNumber}}
                                    </h4>
                                    <br>
                                </div>
                            </div>
                            <hr class="border-l-neutral-600">
                            <div class="flex gap-3">
                                <div class="field col-7">
                                    <h4 class="text-blue-700">Bill From</h4>
                                    <h5>{{this.activeInvoice.vendor?.address?.billingName}}</h5>
                                    <h5>{{this.activeInvoice.vendor?.address?.billingAddress}}</h5>
                                    <h5>{{this.activeInvoice.vendor?.address?.city}}
                                        ,{{this.activeInvoice.vendor?.address?.pincode}}</h5>
                                </div>
                                <div class="field col-3">
                                    <h4 class="text-blue-700">Place Of Supply</h4>
                                    <h5>{{this.activeInvoice.purchaseOrder?.placeOfSupply?.stateName}}</h5><br>
                                </div>
                            </div>
                            <div>
                                <p-table [value]="lineitems">
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>Item Detils</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Discount</th>
                                            <th>Total</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template let-lineItem pTemplate="body">
                                        <tr>
                                            <td>{{ lineItem.expenseName?.name }}</td>
                                            <td>{{ lineItem.unitPrice }}</td>
                                            <td>{{ lineItem.quantity }}</td>
                                            <td>{{ lineItem.discount }}</td>
                                            <td>{{ lineItem.amount }}</td>
                                        </tr>
                                    </ng-template>
                                </p-table>

                                <div class="flex mt-5">
                                    <div class="field col-6">

                                    </div>
                                    <div class="field col-6 text-right">
                                        <label>SubTotal:<b>₹ {{this.piSubTotal}}</b> </label>
                                        <hr>
                                        <label class="ml-10">Total:<b>₹ {{this.piSubTotal}}</b> </label>
                                    </div>
                                </div>
                            </div>

                            <div class="flex">
                                <div class="field col-6">
                                    <h4 class="text-blue-600">Description:</h4>
                                    <p>{{this.activeInvoice.description}}</p>
                                </div>
                                <div class="field col-6">
                                    <h4 class="text-blue-600">Status:</h4>
                                    <p>{{this.activeInvoice.status}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <p-footer>
                            </p-footer> -->
                </p-panel>
            </div>

        </div>
    </div>
</div>
<p-blockUI [blocked]="submitted">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
</p-blockUI>